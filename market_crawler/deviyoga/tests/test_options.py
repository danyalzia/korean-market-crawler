# Author: Danyal Zia Khan
# Email: danyal6870@gmail.com
# Copyright (c) 2020-2024 Danyal Zia Khan
# All rights reserved.

from __future__ import annotations

import asyncio

from random import shuffle

from market_crawler.deviyoga.app import (
    PlaywrightBrowser,
    extract_options,
    split_options_text,
    visit_link,
)


async def test_options(browser_headed: PlaywrightBrowser):
    urls = {
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000004",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000236",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000238",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000237",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000235",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000173",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000175",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000174",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000170",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000172",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000171",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000168",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000169",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000167",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000156",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000158",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000153",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000154",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000155",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000157",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000150",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000149",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000151",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000148",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000152",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000016",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000021",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000018",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000015",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000013",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000022",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000014",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000020",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000019",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000023",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000009",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000008",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000012",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000010",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000011",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000252",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000250",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000253",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000256",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000254",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000255",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000249",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000257",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000251",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000330",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000229",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000248",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000230",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000231",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000232",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000226",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000233",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000227",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000234",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000228",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000212",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000214",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000211",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000210",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000208",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000213",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000209",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000216",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000217",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000205",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000204",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000202",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000198",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000201",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000207",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000200",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000203",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000199",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000206",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000190",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000195",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000197",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000181",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000182",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000196",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000193",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000192",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000194",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000191",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000165",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000177",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000164",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000162",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000179",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000178",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000166",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000163",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000176",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000180",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000136",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000138",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000134",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000135",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000159",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000161",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000160",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000123",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000137",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000121",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000111",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000120",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000118",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000116",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000122",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000119",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000112",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000113",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000117",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000110",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000108",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000106",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000104",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000109",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000077",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000074",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000076",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000073",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000078",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000079",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000093",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000075",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000092",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000080",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000035",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000032",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000033",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000034",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000275",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000276",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000272",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000273",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000270",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000277",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000269",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000261",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000271",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000279",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000239",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000241",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000240",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000260",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000102",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000125",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000124",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000101",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000103",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000066",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000065",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000083",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000057",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000081",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000084",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000056",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000086",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000085",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000047",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000046",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000054",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000053",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000029",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000028",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000030",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000052",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000031",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000045",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000024",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000027",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000025",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000026",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000293",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000294",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000291",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000284",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000283",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000099",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000100",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000220",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000219",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000070",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000068",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000069",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000072",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000089",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000088",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000071",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000091",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000090",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000098",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000002",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000001",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000050",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000051",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000049",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000048",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000067",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000000",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000003",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000244",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000246",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000188",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000245",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000247",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000223",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000222",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000218",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000224",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000221",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000144",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000187",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000142",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000145",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000184",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000186",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000147",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000146",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000143",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000183",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000037",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000041",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000042",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000036",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000040",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000043",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000140",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000141",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000038",
        "http://deviyoga.kr/goods/goods_view.php?goodsNo=1000000287",
    }

    urls = list(urls)
    shuffle(urls)
    tasks = (extract(url, browser_headed) for url in urls[:10])
    await asyncio.gather(*tasks)


async def extract(url: str, browser: PlaywrightBrowser):
    page = await browser.new_page()
    await visit_link(page, url)

    try:
        options = (await extract_options(page, url)).unwrap()
    except Exception:
        print(f"Error URL: {url}")
        raise
    for option, price3 in options:
        print((option, price3))
        print(split_options_text(option).unwrap())

    await page.close()
