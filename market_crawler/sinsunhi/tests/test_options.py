from __future__ import annotations

import asyncio

from random import shuffle

from market_crawler.sinsunhi.app import (
    PlaywrightBrowser,
    extract_options,
    split_options_text,
    visit_link,
)


async def test_options(browser_headed: PlaywrightBrowser):
    urls = {
        "https://www.sinsunhi.com/buyer/products/789",
        "https://www.sinsunhi.com/buyer/products/2624",
        "https://www.sinsunhi.com/buyer/products/572",
        "https://www.sinsunhi.com/buyer/products/399",
        "https://www.sinsunhi.com/buyer/products/1431",
        "https://www.sinsunhi.com/buyer/products/1430",
        "https://www.sinsunhi.com/buyer/products/10080",
        "https://www.sinsunhi.com/buyer/products/2641",
        "https://www.sinsunhi.com/buyer/products/2635",
        "https://www.sinsunhi.com/buyer/products/10026",
        "https://www.sinsunhi.com/buyer/products/10118",
        "https://www.sinsunhi.com/buyer/products/10117",
        "https://www.sinsunhi.com/buyer/products/10124",
        "https://www.sinsunhi.com/buyer/products/10116",
        "https://www.sinsunhi.com/buyer/products/10114",
        "https://www.sinsunhi.com/buyer/products/10132",
        "https://www.sinsunhi.com/buyer/products/10136",
        "https://www.sinsunhi.com/buyer/products/10133",
        "https://www.sinsunhi.com/buyer/products/10125",
        "https://www.sinsunhi.com/buyer/products/10129",
        "https://www.sinsunhi.com/buyer/products/10127",
        "https://www.sinsunhi.com/buyer/products/10128",
        "https://www.sinsunhi.com/buyer/products/10135",
        "https://www.sinsunhi.com/buyer/products/10126",
        "https://www.sinsunhi.com/buyer/products/10130",
        "https://www.sinsunhi.com/buyer/products/10151",
        "https://www.sinsunhi.com/buyer/products/10138",
        "https://www.sinsunhi.com/buyer/products/10150",
        "https://www.sinsunhi.com/buyer/products/10148",
        "https://www.sinsunhi.com/buyer/products/10145",
        "https://www.sinsunhi.com/buyer/products/10149",
        "https://www.sinsunhi.com/buyer/products/10152",
        "https://www.sinsunhi.com/buyer/products/10155",
        "https://www.sinsunhi.com/buyer/products/10162",
        "https://www.sinsunhi.com/buyer/products/10158",
        "https://www.sinsunhi.com/buyer/products/10163",
        "https://www.sinsunhi.com/buyer/products/10156",
        "https://www.sinsunhi.com/buyer/products/10160",
        "https://www.sinsunhi.com/buyer/products/10157",
        "https://www.sinsunhi.com/buyer/products/10161",
        "https://www.sinsunhi.com/buyer/products/10175",
        "https://www.sinsunhi.com/buyer/products/10164",
        "https://www.sinsunhi.com/buyer/products/10172",
        "https://www.sinsunhi.com/buyer/products/10176",
        "https://www.sinsunhi.com/buyer/products/10173",
        "https://www.sinsunhi.com/buyer/products/10186",
        "https://www.sinsunhi.com/buyer/products/10184",
        "https://www.sinsunhi.com/buyer/products/10188",
        "https://www.sinsunhi.com/buyer/products/10185",
        "https://www.sinsunhi.com/buyer/products/10183",
        "https://www.sinsunhi.com/buyer/products/10177",
        "https://www.sinsunhi.com/buyer/products/10179",
        "https://www.sinsunhi.com/buyer/products/10178",
        "https://www.sinsunhi.com/buyer/products/10181",
        "https://www.sinsunhi.com/buyer/products/10252",
        "https://www.sinsunhi.com/buyer/products/10192",
        "https://www.sinsunhi.com/buyer/products/10189",
        "https://www.sinsunhi.com/buyer/products/10249",
        "https://www.sinsunhi.com/buyer/products/10190",
        "https://www.sinsunhi.com/buyer/products/10241",
        "https://www.sinsunhi.com/buyer/products/10245",
        "https://www.sinsunhi.com/buyer/products/10310",
        "https://www.sinsunhi.com/buyer/products/10274",
        "https://www.sinsunhi.com/buyer/products/10309",
        "https://www.sinsunhi.com/buyer/products/10269",
        "https://www.sinsunhi.com/buyer/products/10265",
        "https://www.sinsunhi.com/buyer/products/10308",
        "https://www.sinsunhi.com/buyer/products/10258",
        "https://www.sinsunhi.com/buyer/products/10263",
        "https://www.sinsunhi.com/buyer/products/10259",
        "https://www.sinsunhi.com/buyer/products/10479",
        "https://www.sinsunhi.com/buyer/products/10450",
        "https://www.sinsunhi.com/buyer/products/10456",
        "https://www.sinsunhi.com/buyer/products/10482",
        "https://www.sinsunhi.com/buyer/products/10477",
        "https://www.sinsunhi.com/buyer/products/10476",
        "https://www.sinsunhi.com/buyer/products/10481",
        "https://www.sinsunhi.com/buyer/products/10452",
        "https://www.sinsunhi.com/buyer/products/10503",
        "https://www.sinsunhi.com/buyer/products/10506",
        "https://www.sinsunhi.com/buyer/products/10572",
        "https://www.sinsunhi.com/buyer/products/10502",
        "https://www.sinsunhi.com/buyer/products/10551",
        "https://www.sinsunhi.com/buyer/products/10622",
        "https://www.sinsunhi.com/buyer/products/10582",
        "https://www.sinsunhi.com/buyer/products/10574",
        "https://www.sinsunhi.com/buyer/products/10120",
        "https://www.sinsunhi.com/buyer/products/10580",
        "https://www.sinsunhi.com/buyer/products/10134",
        "https://www.sinsunhi.com/buyer/products/10585",
        "https://www.sinsunhi.com/buyer/products/10576",
        "https://www.sinsunhi.com/buyer/products/10584",
        "https://www.sinsunhi.com/buyer/products/751",
        "https://www.sinsunhi.com/buyer/products/1922",
        "https://www.sinsunhi.com/buyer/products/387",
        "https://www.sinsunhi.com/buyer/products/2246",
        "https://www.sinsunhi.com/buyer/products/1921",
        "https://www.sinsunhi.com/buyer/products/2654",
        "https://www.sinsunhi.com/buyer/products/607",
        "https://www.sinsunhi.com/buyer/products/10558",
        "https://www.sinsunhi.com/buyer/products/10100",
        "https://www.sinsunhi.com/buyer/products/2615",
        "https://www.sinsunhi.com/buyer/products/425",
        "https://www.sinsunhi.com/buyer/products/10627",
        "https://www.sinsunhi.com/buyer/products/726",
        "https://www.sinsunhi.com/buyer/products/1428",
        "https://www.sinsunhi.com/buyer/products/1429",
        "https://www.sinsunhi.com/buyer/products/259",
        "https://www.sinsunhi.com/buyer/products/608",
        "https://www.sinsunhi.com/buyer/products/10640",
        "https://www.sinsunhi.com/buyer/products/807",
        "https://www.sinsunhi.com/buyer/products/589",
        "https://www.sinsunhi.com/buyer/products/400",
        "https://www.sinsunhi.com/buyer/products/378",
        "https://www.sinsunhi.com/buyer/products/2232",
        "https://www.sinsunhi.com/buyer/products/2374",
        "https://www.sinsunhi.com/buyer/products/2372",
        "https://www.sinsunhi.com/buyer/products/2369",
        "https://www.sinsunhi.com/buyer/products/2334",
        "https://www.sinsunhi.com/buyer/products/2154",
        "https://www.sinsunhi.com/buyer/products/2388",
        "https://www.sinsunhi.com/buyer/products/1959",
        "https://www.sinsunhi.com/buyer/products/2431",
        "https://www.sinsunhi.com/buyer/products/2614",
        "https://www.sinsunhi.com/buyer/products/2656",
        "https://www.sinsunhi.com/buyer/products/2655",
        "https://www.sinsunhi.com/buyer/products/2438",
        "https://www.sinsunhi.com/buyer/products/2621",
        "https://www.sinsunhi.com/buyer/products/2569",
        "https://www.sinsunhi.com/buyer/products/2626",
        "https://www.sinsunhi.com/buyer/products/2601",
        "https://www.sinsunhi.com/buyer/products/10039",
        "https://www.sinsunhi.com/buyer/products/2702",
        "https://www.sinsunhi.com/buyer/products/10043",
        "https://www.sinsunhi.com/buyer/products/2705",
        "https://www.sinsunhi.com/buyer/products/10046",
        "https://www.sinsunhi.com/buyer/products/10084",
        "https://www.sinsunhi.com/buyer/products/10199",
        "https://www.sinsunhi.com/buyer/products/10193",
        "https://www.sinsunhi.com/buyer/products/10213",
        "https://www.sinsunhi.com/buyer/products/10209",
        "https://www.sinsunhi.com/buyer/products/10095",
        "https://www.sinsunhi.com/buyer/products/10224",
        "https://www.sinsunhi.com/buyer/products/10088",
        "https://www.sinsunhi.com/buyer/products/10111",
        "https://www.sinsunhi.com/buyer/products/10225",
        "https://www.sinsunhi.com/buyer/products/10314",
        "https://www.sinsunhi.com/buyer/products/10488",
        "https://www.sinsunhi.com/buyer/products/10494",
        "https://www.sinsunhi.com/buyer/products/10516",
        "https://www.sinsunhi.com/buyer/products/10489",
        "https://www.sinsunhi.com/buyer/products/10490",
        "https://www.sinsunhi.com/buyer/products/10509",
        "https://www.sinsunhi.com/buyer/products/10492",
        "https://www.sinsunhi.com/buyer/products/10550",
        "https://www.sinsunhi.com/buyer/products/10082",
        "https://www.sinsunhi.com/buyer/products/10083",
        "https://www.sinsunhi.com/buyer/products/10079",
        "https://www.sinsunhi.com/buyer/products/10081",
        "https://www.sinsunhi.com/buyer/products/2678",
        "https://www.sinsunhi.com/buyer/products/10662",
        "https://www.sinsunhi.com/buyer/products/10658",
        "https://www.sinsunhi.com/buyer/products/10171",
        "https://www.sinsunhi.com/buyer/products/10170",
        "https://www.sinsunhi.com/buyer/products/10168",
        "https://www.sinsunhi.com/buyer/products/10659",
        "https://www.sinsunhi.com/buyer/products/10166",
        "https://www.sinsunhi.com/buyer/products/10075",
        "https://www.sinsunhi.com/buyer/products/10664",
        "https://www.sinsunhi.com/buyer/products/10647",
        "https://www.sinsunhi.com/buyer/products/10610",
        "https://www.sinsunhi.com/buyer/products/10611",
        "https://www.sinsunhi.com/buyer/products/10641",
        "https://www.sinsunhi.com/buyer/products/10465",
        "https://www.sinsunhi.com/buyer/products/10461",
        "https://www.sinsunhi.com/buyer/products/10463",
        "https://www.sinsunhi.com/buyer/products/10466",
        "https://www.sinsunhi.com/buyer/products/10567",
        "https://www.sinsunhi.com/buyer/products/10540",
        "https://www.sinsunhi.com/buyer/products/10665",
        "https://www.sinsunhi.com/buyer/products/10491",
        "https://www.sinsunhi.com/buyer/products/10289",
        "https://www.sinsunhi.com/buyer/products/10661",
        "https://www.sinsunhi.com/buyer/products/10470",
        "https://www.sinsunhi.com/buyer/products/10493",
        "https://www.sinsunhi.com/buyer/products/10471",
        "https://www.sinsunhi.com/buyer/products/10109",
        "https://www.sinsunhi.com/buyer/products/10290",
        "https://www.sinsunhi.com/buyer/products/363",
        "https://www.sinsunhi.com/buyer/products/445",
        "https://www.sinsunhi.com/buyer/products/490",
        "https://www.sinsunhi.com/buyer/products/459",
        "https://www.sinsunhi.com/buyer/products/871",
        "https://www.sinsunhi.com/buyer/products/758",
        "https://www.sinsunhi.com/buyer/products/823",
        "https://www.sinsunhi.com/buyer/products/752",
        "https://www.sinsunhi.com/buyer/products/796",
        "https://www.sinsunhi.com/buyer/products/760",
        "https://www.sinsunhi.com/buyer/products/770",
        "https://www.sinsunhi.com/buyer/products/2475",
        "https://www.sinsunhi.com/buyer/products/2458",
        "https://www.sinsunhi.com/buyer/products/1639",
        "https://www.sinsunhi.com/buyer/products/2476",
        "https://www.sinsunhi.com/buyer/products/2692",
        "https://www.sinsunhi.com/buyer/products/2581",
        "https://www.sinsunhi.com/buyer/products/2508",
        "https://www.sinsunhi.com/buyer/products/2479",
        "https://www.sinsunhi.com/buyer/products/2594",
        "https://www.sinsunhi.com/buyer/products/2574",
        "https://www.sinsunhi.com/buyer/products/2573",
        "https://www.sinsunhi.com/buyer/products/2491",
        "https://www.sinsunhi.com/buyer/products/2507",
        "https://www.sinsunhi.com/buyer/products/2578",
        "https://www.sinsunhi.com/buyer/products/10200",
        "https://www.sinsunhi.com/buyer/products/10159",
        "https://www.sinsunhi.com/buyer/products/10119",
        "https://www.sinsunhi.com/buyer/products/10198",
        "https://www.sinsunhi.com/buyer/products/10074",
        "https://www.sinsunhi.com/buyer/products/2724",
        "https://www.sinsunhi.com/buyer/products/10202",
        "https://www.sinsunhi.com/buyer/products/10232",
        "https://www.sinsunhi.com/buyer/products/10277",
        "https://www.sinsunhi.com/buyer/products/10255",
        "https://www.sinsunhi.com/buyer/products/10278",
        "https://www.sinsunhi.com/buyer/products/10271",
        "https://www.sinsunhi.com/buyer/products/10261",
        "https://www.sinsunhi.com/buyer/products/10267",
        "https://www.sinsunhi.com/buyer/products/10545",
        "https://www.sinsunhi.com/buyer/products/10285",
        "https://www.sinsunhi.com/buyer/products/10300",
        "https://www.sinsunhi.com/buyer/products/10281",
        "https://www.sinsunhi.com/buyer/products/10284",
        "https://www.sinsunhi.com/buyer/products/10547",
        "https://www.sinsunhi.com/buyer/products/10464",
        "https://www.sinsunhi.com/buyer/products/10282",
        "https://www.sinsunhi.com/buyer/products/10508",
        "https://www.sinsunhi.com/buyer/products/10507",
        "https://www.sinsunhi.com/buyer/products/10565",
        "https://www.sinsunhi.com/buyer/products/10564",
        "https://www.sinsunhi.com/buyer/products/10593",
        "https://www.sinsunhi.com/buyer/products/2132",
        "https://www.sinsunhi.com/buyer/products/2130",
        "https://www.sinsunhi.com/buyer/products/2131",
        "https://www.sinsunhi.com/buyer/products/2140",
        "https://www.sinsunhi.com/buyer/products/2138",
        "https://www.sinsunhi.com/buyer/products/10590",
        "https://www.sinsunhi.com/buyer/products/2119",
        "https://www.sinsunhi.com/buyer/products/2114",
        "https://www.sinsunhi.com/buyer/products/2124",
        "https://www.sinsunhi.com/buyer/products/2111",
        "https://www.sinsunhi.com/buyer/products/2117",
        "https://www.sinsunhi.com/buyer/products/2115",
        "https://www.sinsunhi.com/buyer/products/2116",
        "https://www.sinsunhi.com/buyer/products/2112",
        "https://www.sinsunhi.com/buyer/products/10668",
        "https://www.sinsunhi.com/buyer/products/2612",
        "https://www.sinsunhi.com/buyer/products/2134",
        "https://www.sinsunhi.com/buyer/products/2625",
        "https://www.sinsunhi.com/buyer/products/2629",
        "https://www.sinsunhi.com/buyer/products/2694",
        "https://www.sinsunhi.com/buyer/products/2123",
        "https://www.sinsunhi.com/buyer/products/10103",
        "https://www.sinsunhi.com/buyer/products/2620",
        "https://www.sinsunhi.com/buyer/products/2695",
        "https://www.sinsunhi.com/buyer/products/2632",
        "https://www.sinsunhi.com/buyer/products/2670",
        "https://www.sinsunhi.com/buyer/products/2667",
        "https://www.sinsunhi.com/buyer/products/2693",
        "https://www.sinsunhi.com/buyer/products/10024",
        "https://www.sinsunhi.com/buyer/products/2713",
        "https://www.sinsunhi.com/buyer/products/2714",
        "https://www.sinsunhi.com/buyer/products/2697",
        "https://www.sinsunhi.com/buyer/products/2696",
        "https://www.sinsunhi.com/buyer/products/2715",
        "https://www.sinsunhi.com/buyer/products/10458",
        "https://www.sinsunhi.com/buyer/products/10454",
        "https://www.sinsunhi.com/buyer/products/10091",
        "https://www.sinsunhi.com/buyer/products/10025",
        "https://www.sinsunhi.com/buyer/products/10048",
        "https://www.sinsunhi.com/buyer/products/10313",
        "https://www.sinsunhi.com/buyer/products/10110",
        "https://www.sinsunhi.com/buyer/products/10165",
        "https://www.sinsunhi.com/buyer/products/10141",
        "https://www.sinsunhi.com/buyer/products/10093",
        "https://www.sinsunhi.com/buyer/products/10459",
        "https://www.sinsunhi.com/buyer/products/10486",
        "https://www.sinsunhi.com/buyer/products/10560",
        "https://www.sinsunhi.com/buyer/products/10497",
        "https://www.sinsunhi.com/buyer/products/10460",
        "https://www.sinsunhi.com/buyer/products/10538",
        "https://www.sinsunhi.com/buyer/products/10549",
        "https://www.sinsunhi.com/buyer/products/10485",
        "https://www.sinsunhi.com/buyer/products/10595",
        "https://www.sinsunhi.com/buyer/products/10625",
        "https://www.sinsunhi.com/buyer/products/10568",
        "https://www.sinsunhi.com/buyer/products/10616",
        "https://www.sinsunhi.com/buyer/products/10628",
        "https://www.sinsunhi.com/buyer/products/10607",
        "https://www.sinsunhi.com/buyer/products/10536",
        "https://www.sinsunhi.com/buyer/products/384",
        "https://www.sinsunhi.com/buyer/products/509",
        "https://www.sinsunhi.com/buyer/products/10605",
        "https://www.sinsunhi.com/buyer/products/10301",
        "https://www.sinsunhi.com/buyer/products/10054",
        "https://www.sinsunhi.com/buyer/products/10586",
        "https://www.sinsunhi.com/buyer/products/383",
        "https://www.sinsunhi.com/buyer/products/640",
        "https://www.sinsunhi.com/buyer/products/225",
        "https://www.sinsunhi.com/buyer/products/899",
        "https://www.sinsunhi.com/buyer/products/641",
        "https://www.sinsunhi.com/buyer/products/448",
        "https://www.sinsunhi.com/buyer/products/373",
        "https://www.sinsunhi.com/buyer/products/10623",
        "https://www.sinsunhi.com/buyer/products/698",
        "https://www.sinsunhi.com/buyer/products/690",
        "https://www.sinsunhi.com/buyer/products/730",
        "https://www.sinsunhi.com/buyer/products/790",
        "https://www.sinsunhi.com/buyer/products/699",
        "https://www.sinsunhi.com/buyer/products/679",
        "https://www.sinsunhi.com/buyer/products/753",
        "https://www.sinsunhi.com/buyer/products/2133",
        "https://www.sinsunhi.com/buyer/products/10782",
        "https://www.sinsunhi.com/buyer/products/854",
        "https://www.sinsunhi.com/buyer/products/2450",
        "https://www.sinsunhi.com/products/13338",
        "https://www.sinsunhi.com/products/10100",
        "https://www.sinsunhi.com/products/13490",
        "https://www.sinsunhi.com/buyer/products/10892",
        "https://www.sinsunhi.com/products/10456",
        "https://www.sinsunhi.com/products/13917",
    }

    urls = list(urls)
    shuffle(urls)

    tasks = (asyncio.create_task(extract(url, browser_headed)) for url in urls[:5])
    await asyncio.gather(*tasks)


async def extract(url: str, browser: PlaywrightBrowser):
    page = await browser.new_page()
    await visit_link(page, url)

    options = (await extract_options(page, url)).unwrap()

    for option, price3, delivery_fee, message1 in options:
        print((option, price3, delivery_fee, message1))
        print(split_options_text(option).unwrap())

    await page.close()
